<!DOCTYPE html>
<html lang="en">
  <head>
    
    <meta charset="utf-8" />
    <link rel="icon" href="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.11.1/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.11.1/addons/p5.sound.min.js"></script>
    
    <title>invite</title>
    <link rel="stylesheet" href="styles.css">
    <script src="sketch.js" ></script>
    <script src="script.js"></script>
    
    <script>
      
      function drawFlower(){
        if (!window.canvas) {
          console.warn("Canvas not ready yet. Retrying...");
          setTimeout(drawFlower, 100); // Retry after 100ms
          return;
        }
        
        canvas.elt.style.display = 'block'; 
        //document.getElementById('message').classList.add('hidden');
        document.getElementById('message').innerHTML = "Please begin!"
        let wrap = document.getElementById("wrapper");
        
        let butt0 = document.createElement("button");
        butt0.id = "butt0";
        butt0.innerText = "Oops!";
        butt0.onclick = () => {if(flower.coord.length>1){flower.erase_last();}}
        wrap.appendChild(butt0);
        
        let butt1 = document.createElement("button");
        butt1.id = "butt1";
        butt1.innerText = "Can I start over?";
        butt1.onclick = () => {if(flower.coord.length>1){flower.erase_all();}}
        wrap.appendChild(butt1);
        
        let butt2 = document.createElement("button");
        butt2.id = "butt2";
        butt2.innerText = "Finished!";
        butt2.onclick = () => {signImg();}
        wrap.appendChild(butt2);


      }
      
      function download(content, fileName, contentType) {
					var a = document.createElement("a");
					var file = new Blob([content], {type: contentType});
					a.href = URL.createObjectURL(file);
					a.download = fileName;
					a.click();
			}
      
      
      function signImg(){
        stage = 1;
        document.getElementById("butt0").remove();
        document.getElementById("butt1").remove();
        document.getElementById("butt2").remove();
        document.getElementById('message').innerHTML = "Looks great!"

        let wrap = document.getElementById("wrapper");

        let nameQ = document.createElement("div");
        nameQ.innerText = "Please sign your name below:";
        nameQ.style.fontSize = "20px";
        wrap.appendChild(nameQ);

        let field = document.createElement("input");
        field.type = "text";
        wrap.appendChild(field);
        
        let butt = document.createElement("button");
        butt.innerText = "SAVE"
        wrap.appendChild(butt);
        
        butt.onclick = () => {
          let params = {
            name: field.value,
            coords:flower.coord
          }
          download(JSON.stringify(params), "my flower", 'text/plain');
        }
      }

    </script>
  
    <link rel="stylesheet" href="/style.css" />
  
  </head>
  <body>
    <div id="wrapper">
      <p id="message">
        Hello! <br>
        We need something from you. <br><br>
        Will you draw your favourite flower for us?<br><br>
        <button onclick="drawFlower();">Yes, I know just the one...</button>
      </p>
    </div>
<!-- 
    {{#if redo}}
      <script> window.onload = () => {console.log("skipping first text"); drawFlower();} </script>
    {{/if}} 
 -->
  </body>
</html>